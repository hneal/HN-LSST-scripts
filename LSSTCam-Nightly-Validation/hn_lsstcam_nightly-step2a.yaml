# https://rubinobs.atlassian.net/browse/DM-48550
# Nightly Validation Pipeline on on-sky ComCam data
# Dataset query example:
#  butler query-datasets embargo raw --collections LSSTCam/raw/all | tail -20
#  raw LSSTCam/raw/all a159f440-2c88-5e70-bc87-723efd03b8d3 LSSTCam        8 2024102100519       r 20241021 2024-10-21T22:26:03.650            r_03
#
# Nominal required setup:
# Pipeline:
# https://github.com/lsst/drp_pipe/blob/main/pipelines/LSSTCam/nightly-validation.yaml
#
# Collection Names:
# repo: embargo
#
# collections:
# intra-night: LSSTCam/nightlyValidation
# 10am: LSSTCam/runs/nightlyValidation/{day_obs}/<lsst_distrib_tag>/DM-XXXXX
# skymap='ops_rehersal_prep_2k_v1'?
#
# pipeline command line example:
# pipetask run -b embargo_new -i LSSTCam/defaults -o u/yusra/testPipelines -p $DRP_PIPE_DIR/pipelines/LSSTCam/nightly-validation.yaml#isr -d "exposure.day_obs = 20241022 AND exposure.seq_num=47 AND instrument='LSSTCam'"
# --------------------------------------------------------------------------------------
includeConfigs:
  - requestMemory_LSSTCam_NIGHTLY.yaml


LSST_VERSION: ${DISTRIB}

pipelineYaml: "${DRP_PIPE_DIR}/pipelines/LSSTCam/nightly-validation.yaml#step2a"


project: DM-48550
campaign: DM-48550

extraQgraphOptions: -c parameters:sasquatch_dataset_identifier=LSSTCam/nightlyValidation -c parameters:sasquatch_timestamp_version=explicit_timestamp:${SASQ_TIMESTAMP}T000000Z

payload:
  runInit: true
  payloadName: lsstcam_nightly
  butlerConfig: embargo_new+sasquatch_dev
  inCollection: LSSTCam/defaults

#  output: u/homer/DM-48550/${DISTRIB}/pipeline_test4_${NIGHTLY_START}
  output: LSSTCam/runs/nightlyValidation/${NIGHTLY_START}/${DISTRIB}/DM-48550

  dataQuery: "instrument='LSSTCam'"

#  dataQuery: "instrument='LSSTCam' AND (exposure.day_obs>=${NIGHTLY_START} and exposure.day_obs<=${NIGHTLY_END}) AND exposure.observation_type IN ('science', 'acq') AND skymap='lsst_cells_v1'"
#  ValueError: A BpsConfig could not be loaded from other: /sdf/data/rubin/shared/campaigns/ComCam-Nightly-Validation/hn_lsstcam_nightly-step2a:.yaml

  s3EndpointUrl: "https://s3dfrgw.slac.stanford.edu"
#  payloadFolder: payload
  
numberOfRetries: 3

# Condor backend stuff
wmsServiceClass: lsst.ctrl.bps.htcondor.HTCondorService
